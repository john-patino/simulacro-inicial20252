<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Informe Integral – Diagnóstico 2025-2</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg: #0b1020;
  --panel: #101729;
  --text: #e6e9ef;
  --muted: #9aa4b2;
  --line: rgba(255,255,255,0.12);
  --accent: #5eead4;
  --accent2: #22d3ee;
}
*{box-sizing:border-box;}
body{
  margin:0;background:radial-gradient(1200px 600px at -10% -10%,rgba(34,211,238,.14),transparent 40%),
  radial-gradient(1000px 500px at 110% -10%,rgba(94,234,212,.14),transparent 42%),var(--bg);color:var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial;
  line-height:1.5;
}
.header{
  padding:36px 16px;border-bottom:1px solid var(--line);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
}
.wrap{max-width:1200px;margin:0 auto;padding:0 16px;}
.h1{font-size:28px;margin:0 0 4px;}
.sub{color:var(--muted)}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;margin:20px 0;}
.card{
  background:rgba(16,23,41,.65);border:1px solid var(--line);border-radius:16px;padding:16px;
  backdrop-filter: blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.col-3{grid-column:span 3} .col-4{grid-column:span 4} .col-6{grid-column:span 6} .col-8{grid-column:span 8} .col-12{grid-column:span 12}
@media(max-width:1024px){.col-3,.col-4,.col-6,.col-8,.col-12{grid-column:span 12}}
.kpi .big{font-size:28px;font-weight:700} .kpi .label{color:var(--muted);font-size:12px}
h2{margin:16px 0 8px} h3{margin:12px 0 8px;font-size:16px;color:#bfefff}
table{width:100%;border-collapse:collapse;font-size:13px}
thead th{position:sticky;top:0;background:#0c162b;color:#cfeffd;text-align:left}
th,td{padding:10px;border-bottom:1px solid var(--line);}
.badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;background:rgba(94,234,212,.12);border:1px solid rgba(94,234,212,.35);color:#bff}
.section{margin:28px 0}
.small{color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <div class="header">
    <div class="wrap">
      <div class="h1">Informe Integral – Prueba Diagnóstica de Competencias Genéricas 2025-2</div>
      <div class="sub">Escala total 0–300. Competencias: Inglés, Lectura Crítica, Razonamiento Cuantitativo, Competencias Ciudadanas.</div>
    </div>
  </div>
  <div class="wrap">

    <!-- Resumen Ejecutivo -->
    <div class="section">
      <h2>1) Resumen ejecutivo</h2>
      <div class="grid">
        <div class="card col-3 kpi">
          <div class="big">1359</div>
          <div class="label">Estudiantes evaluados</div>
        </div>
        <div class="card col-3 kpi">
          <div class="big">100.0%</div>
          <div class="label">Total = suma de ítems</div>
        </div>
        <div class="card col-3 kpi">
          <div class="big">0–300</div>
          <div class="label">Escala de la nota total</div>
        </div>
        <div class="card col-3 kpi">
          <div class="big">0–75</div>
          <div class="label">Escala por competencia</div>
        </div>

        <div class="card col-6">
          <h3>Promedio por sede</h3>
          <canvas id="chartPorSede"></canvas>
        </div>
        <div class="card col-6">
          <h3>Tabla por sede</h3>
          <table>
            <thead>
              <tr><th>Sede</th><th>n</th><th>Promedio</th><th>% sobre 300</th><th>Desv.Est.</th><th>Mín</th><th>Máx</th></tr>
            </thead>
            <tbody id="tb-sedes"></tbody>
          </table>
        </div>
      </div>
      <div class="small">Nota: Los promedios se basan en <strong>Total de puntos (0–300)</strong>. Los % se calculan sobre 300.</div>
    </div>

    <!-- Aguachica -->
    <div class="section">
      <h2>2) Sede Aguachica</h2>
      <div class="grid">
        <div class="card col-12">
          <h3>Ranking de programas por promedio (0–300)</h3>
          <canvas id="chartAguachicaProgramas"></canvas>
        </div>
        <div class="card col-12">
          <h3>Tabla de programas (Aguachica)</h3>
          <table>
            <thead><tr><th>Programa</th><th>n</th><th>Promedio</th><th>% sobre 300</th><th>Desv.Est.</th><th>Mín</th><th>Máx</th></tr></thead>
            <tbody id="tb-aguachica"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Valledupar -->
    <div class="section">
      <h2>3) Sede Valledupar</h2>
      <div class="grid">
        <div class="card col-12">
          <h3>Ranking de programas por promedio (0–300)</h3>
          <canvas id="chartValleduparProgramas"></canvas>
        </div>
        <div class="card col-12">
          <h3>Tabla de programas (Valledupar)</h3>
          <table>
            <thead><tr><th>Programa</th><th>n</th><th>Promedio</th><th>% sobre 300</th><th>Desv.Est.</th><th>Mín</th><th>Máx</th></tr></thead>
            <tbody id="tb-valledupar"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Ejemplo: Admin de Empresas - Valledupar -->
    <div class="section">
      <h2>4) Ejemplo solicitado</h2>
      <div class="card">
        <h3>Administración de Empresas – Sede Valledupar</h3>
        <p>Desempeño por competencia (0–75):</p>
        <div class="grid">
          <div class="col-6 card">
            <canvas id="chartEjemploRadar"></canvas>
          </div>
          <div class="col-6 card">
            <table>
              <thead><tr><th>Competencia</th><th>n</th><th>Promedio</th><th>% (0–75)</th><th>Desv.Est.</th><th>Mín</th><th>Máx</th></tr></thead>
              <tbody id="tb-ejemplo"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Tablas completas -->
    <div class="section">
      <h2>5) Tablas completas</h2>
      <div class="card">
        <h3>Explorar todo (selector de sede y programa)</h3>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px">
          <label>Sede</label>
          <select id="selSede"></select>
          <label>Programa</label>
          <select id="selProg"></select>
          <button id="btnCSV">Exportar CSV (competencias del programa)</button>
        </div>
        <div class="grid">
          <div class="col-12 card">
            <h3>Programas de la sede seleccionada</h3>
            <table>
              <thead><tr><th>Programa</th><th>n</th><th>Promedio</th><th>% sobre 300</th><th>Desv.Est.</th><th>Mín</th><th>Máx</th></tr></thead>
              <tbody id="tb-prog-sel"></tbody>
            </table>
          </div>
          <div class="col-12 card">
            <h3>Competencias del programa seleccionado (0–75)</h3>
            <table>
              <thead><tr><th>Competencia</th><th>n</th><th>Promedio</th><th>% (0–75)</th><th>Desv.Est.</th><th>Mín</th><th>Máx</th></tr></thead>
              <tbody id="tb-comp-sel"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="section small">Generado automáticamente con datos agregados (JSON). Se pueden añadir histogramas y percentiles por programa.</div>
  </div>

<script>
const DATA = {"metadata": {"population": 1359, "max_points_total": 300, "max_points_by_competence": 75, "validation_total_equals_sum_items": {"matching_rows": 1359, "total_rows": 1359, "pct_matching": 100.0}}, "sedes": [{"sede": "AGUACHICA", "general": {"n": 176, "mean": 175.22, "std": 66.18, "min": 25, "max": 300, "pct": 58.41}, "programas": [{"programa": "ADMINISTRACION DE EMPRESAS", "total_0a300": {"n": 23, "mean": 199.04, "std": 67.49, "min": 100, "max": 300, "pct": 66.35}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 23, "mean": 52.26, "std": 27.04, "min": 0, "max": 75, "pct": 69.68}, {"competencia": "INGLÉS", "n": 23, "mean": 45.65, "std": 20.85, "min": 0, "max": 75, "pct": 60.87}, {"competencia": "LECTURA CRÍTICA", "n": 23, "mean": 48.96, "std": 30.81, "min": 0, "max": 75, "pct": 65.28}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 23, "mean": 52.17, "std": 14.91, "min": 25, "max": 75, "pct": 69.57}]}, {"programa": "CONTADURIA PUBLICA", "total_0a300": {"n": 36, "mean": 196.69, "std": 68.59, "min": 25, "max": 300, "pct": 65.56}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 36, "mean": 52.19, "std": 25.73, "min": 0, "max": 75, "pct": 69.59}, {"competencia": "INGLÉS", "n": 36, "mean": 40.97, "std": 19.04, "min": 0, "max": 75, "pct": 54.63}, {"competencia": "LECTURA CRÍTICA", "n": 36, "mean": 45.89, "std": 29.87, "min": 0, "max": 75, "pct": 61.19}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 36, "mean": 57.64, "std": 26.61, "min": 0, "max": 75, "pct": 76.85}]}, {"programa": "ECONOMIA", "total_0a300": {"n": 15, "mean": 168.4, "std": 85.11, "min": 25, "max": 300, "pct": 56.13}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 15, "mean": 52.53, "std": 23.7, "min": 0, "max": 75, "pct": 70.04}, {"competencia": "INGLÉS", "n": 15, "mean": 30.0, "std": 25.35, "min": 0, "max": 75, "pct": 40.0}, {"competencia": "LECTURA CRÍTICA", "n": 15, "mean": 42.53, "std": 31.26, "min": 0, "max": 75, "pct": 56.71}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 15, "mean": 43.33, "std": 25.82, "min": 0, "max": 75, "pct": 57.78}]}, {"programa": "ING AMBIENTAL Y SANITARIA", "total_0a300": {"n": 20, "mean": 157.75, "std": 57.2, "min": 38, "max": 275, "pct": 52.58}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 20, "mean": 43.25, "std": 27.92, "min": 0, "max": 75, "pct": 57.67}, {"competencia": "INGLÉS", "n": 20, "mean": 23.75, "std": 17.16, "min": 0, "max": 50, "pct": 31.67}, {"competencia": "LECTURA CRÍTICA", "n": 20, "mean": 43.25, "std": 30.45, "min": 0, "max": 75, "pct": 57.67}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 20, "mean": 47.5, "std": 24.2, "min": 0, "max": 75, "pct": 63.33}]}, {"programa": "ING. AGROINDUSTRIAL", "total_0a300": {"n": 32, "mean": 158.25, "std": 62.92, "min": 50, "max": 300, "pct": 52.75}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 32, "mean": 44.59, "std": 27.65, "min": 0, "max": 75, "pct": 59.46}, {"competencia": "INGLÉS", "n": 32, "mean": 35.16, "std": 17.8, "min": 0, "max": 75, "pct": 46.88}, {"competencia": "LECTURA CRÍTICA", "n": 32, "mean": 33.97, "std": 30.66, "min": 0, "max": 75, "pct": 45.29}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 32, "mean": 44.53, "std": 24.37, "min": 0, "max": 75, "pct": 59.38}]}, {"programa": "ING. SISTEMAS", "total_0a300": {"n": 50, "mean": 168.68, "std": 58.46, "min": 25, "max": 275, "pct": 56.23}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 50, "mean": 47.42, "std": 27.05, "min": 0, "max": 75, "pct": 63.23}, {"competencia": "INGLÉS", "n": 50, "mean": 27.5, "std": 19.72, "min": 0, "max": 75, "pct": 36.67}, {"competencia": "LECTURA CRÍTICA", "n": 50, "mean": 38.26, "std": 25.68, "min": 0, "max": 75, "pct": 51.01}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 50, "mean": 55.5, "std": 19.09, "min": 25, "max": 75, "pct": 74.0}]}]}, {"sede": "VALLEDUPAR", "general": {"n": 1183, "mean": 200.63, "std": 58.66, "min": 25, "max": 300, "pct": 66.88}, "programas": [{"programa": "ADMINISTRACION DE EMPRESAS", "total_0a300": {"n": 107, "mean": 179.36, "std": 58.96, "min": 50, "max": 300, "pct": 59.79}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 107, "mean": 48.84, "std": 25.81, "min": 0, "max": 75, "pct": 65.12}, {"competencia": "INGLÉS", "n": 107, "mean": 38.55, "std": 21.52, "min": 0, "max": 75, "pct": 51.4}, {"competencia": "LECTURA CRÍTICA", "n": 107, "mean": 44.54, "std": 28.27, "min": 0, "max": 75, "pct": 59.39}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 107, "mean": 47.43, "std": 23.02, "min": 0, "max": 75, "pct": 63.24}]}, {"programa": "ADMINISTRACION TURISTICA Y HOTELERA", "total_0a300": {"n": 39, "mean": 167.21, "std": 47.39, "min": 38, "max": 250, "pct": 55.74}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 39, "mean": 52.18, "std": 21.96, "min": 0, "max": 75, "pct": 69.57}, {"competencia": "INGLÉS", "n": 39, "mean": 30.13, "std": 25.12, "min": 0, "max": 75, "pct": 40.17}, {"competencia": "LECTURA CRÍTICA", "n": 39, "mean": 47.08, "std": 29.46, "min": 0, "max": 75, "pct": 62.77}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 39, "mean": 37.82, "std": 23.56, "min": 0, "max": 75, "pct": 50.43}]}, {"programa": "COMERCIO INTERNACIONAL", "total_0a300": {"n": 91, "mean": 168.31, "std": 55.65, "min": 25, "max": 300, "pct": 56.1}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 91, "mean": 53.69, "std": 24.38, "min": 0, "max": 75, "pct": 71.59}, {"competencia": "INGLÉS", "n": 91, "mean": 30.49, "std": 23.81, "min": 0, "max": 75, "pct": 40.66}, {"competencia": "LECTURA CRÍTICA", "n": 91, "mean": 41.26, "std": 28.53, "min": 0, "max": 75, "pct": 55.02}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 91, "mean": 42.86, "std": 22.14, "min": 0, "max": 75, "pct": 57.14}]}, {"programa": "CONTADURIA PUBLICA", "total_0a300": {"n": 120, "mean": 201.23, "std": 49.73, "min": 50, "max": 300, "pct": 67.08}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 120, "mean": 59.18, "std": 21.98, "min": 0, "max": 75, "pct": 78.91}, {"competencia": "INGLÉS", "n": 120, "mean": 36.88, "std": 20.99, "min": 0, "max": 75, "pct": 49.17}, {"competencia": "LECTURA CRÍTICA", "n": 120, "mean": 45.59, "std": 27.16, "min": 0, "max": 75, "pct": 60.79}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 120, "mean": 59.58, "std": 18.67, "min": 0, "max": 75, "pct": 79.44}]}, {"programa": "DERECHO", "total_0a300": {"n": 50, "mean": 229.06, "std": 49.26, "min": 25, "max": 300, "pct": 76.35}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 50, "mean": 67.58, "std": 16.8, "min": 0, "max": 75, "pct": 90.11}, {"competencia": "INGLÉS", "n": 50, "mean": 43.0, "std": 19.59, "min": 0, "max": 75, "pct": 57.33}, {"competencia": "LECTURA CRÍTICA", "n": 50, "mean": 56.98, "std": 26.52, "min": 0, "max": 75, "pct": 75.97}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 50, "mean": 61.5, "std": 17.65, "min": 25, "max": 75, "pct": 82.0}]}, {"programa": "ECONOMIA", "total_0a300": {"n": 36, "mean": 218.53, "std": 58.89, "min": 63, "max": 300, "pct": 72.84}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 36, "mean": 58.44, "std": 24.36, "min": 0, "max": 75, "pct": 77.93}, {"competencia": "INGLÉS", "n": 36, "mean": 47.22, "std": 17.71, "min": 25, "max": 75, "pct": 62.96}, {"competencia": "LECTURA CRÍTICA", "n": 36, "mean": 53.14, "std": 24.34, "min": 0, "max": 75, "pct": 70.85}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 36, "mean": 59.72, "std": 21.78, "min": 0, "max": 75, "pct": 79.63}]}, {"programa": "ENFERMERIA", "total_0a300": {"n": 36, "mean": 221.28, "std": 52.03, "min": 62, "max": 300, "pct": 73.76}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 36, "mean": 61.58, "std": 20.2, "min": 0, "max": 75, "pct": 82.11}, {"competencia": "INGLÉS", "n": 36, "mean": 38.89, "std": 18.37, "min": 0, "max": 75, "pct": 51.85}, {"competencia": "LECTURA CRÍTICA", "n": 36, "mean": 58.31, "std": 24.48, "min": 0, "max": 75, "pct": 77.74}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 36, "mean": 62.5, "std": 18.42, "min": 25, "max": 75, "pct": 83.33}]}, {"programa": "FISIOTERAPIA", "total_0a300": {"n": 34, "mean": 244.24, "std": 43.55, "min": 138, "max": 300, "pct": 81.41}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 34, "mean": 66.29, "std": 15.93, "min": 38, "max": 75, "pct": 88.39}, {"competencia": "INGLÉS", "n": 34, "mean": 49.26, "std": 15.67, "min": 25, "max": 75, "pct": 65.69}, {"competencia": "LECTURA CRÍTICA", "n": 34, "mean": 61.76, "std": 20.4, "min": 0, "max": 75, "pct": 82.35}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 34, "mean": 66.91, "std": 15.96, "min": 25, "max": 75, "pct": 89.22}]}, {"programa": "ING AMBIENTAL Y SANITARIA", "total_0a300": {"n": 43, "mean": 183.86, "std": 56.97, "min": 38, "max": 300, "pct": 61.29}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 43, "mean": 48.14, "std": 23.53, "min": 0, "max": 75, "pct": 64.19}, {"competencia": "INGLÉS", "n": 43, "mean": 32.56, "std": 22.84, "min": 0, "max": 75, "pct": 43.41}, {"competencia": "LECTURA CRÍTICA", "n": 43, "mean": 54.91, "std": 26.35, "min": 0, "max": 75, "pct": 73.21}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 43, "mean": 48.26, "std": 22.75, "min": 0, "max": 75, "pct": 64.34}]}, {"programa": "ING. AGROINDUSTRIAL", "total_0a300": {"n": 55, "mean": 183.04, "std": 54.13, "min": 50, "max": 300, "pct": 61.01}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 55, "mean": 45.75, "std": 27.64, "min": 0, "max": 75, "pct": 60.99}, {"competencia": "INGLÉS", "n": 55, "mean": 38.64, "std": 20.31, "min": 0, "max": 75, "pct": 51.52}, {"competencia": "LECTURA CRÍTICA", "n": 55, "mean": 49.11, "std": 28.75, "min": 0, "max": 75, "pct": 65.48}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 55, "mean": 49.55, "std": 22.82, "min": 0, "max": 75, "pct": 66.06}]}, {"programa": "ING. ELECTRONICA", "total_0a300": {"n": 5, "mean": 195.2, "std": 56.29, "min": 125, "max": 275, "pct": 65.07}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 5, "mean": 60.2, "std": 20.27, "min": 38, "max": 75, "pct": 80.27}, {"competencia": "INGLÉS", "n": 5, "mean": 30.0, "std": 27.39, "min": 0, "max": 50, "pct": 40.0}, {"competencia": "LECTURA CRÍTICA", "n": 5, "mean": 45.0, "std": 41.08, "min": 0, "max": 75, "pct": 60.0}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 5, "mean": 60.0, "std": 13.69, "min": 50, "max": 75, "pct": 80.0}]}, {"programa": "ING. SISTEMAS", "total_0a300": {"n": 121, "mean": 228.09, "std": 50.08, "min": 25, "max": 300, "pct": 76.03}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 121, "mean": 62.99, "std": 19.99, "min": 0, "max": 75, "pct": 83.99}, {"competencia": "INGLÉS", "n": 121, "mean": 43.6, "std": 21.05, "min": 0, "max": 75, "pct": 58.13}, {"competencia": "LECTURA CRÍTICA", "n": 121, "mean": 57.66, "std": 24.69, "min": 0, "max": 75, "pct": 76.88}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 121, "mean": 63.84, "std": 16.44, "min": 0, "max": 75, "pct": 85.12}]}, {"programa": "INSTRUMENTACION QUIRURGICA", "total_0a300": {"n": 36, "mean": 195.97, "std": 40.09, "min": 125, "max": 275, "pct": 65.32}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 36, "mean": 58.5, "std": 22.6, "min": 0, "max": 75, "pct": 78.0}, {"competencia": "INGLÉS", "n": 36, "mean": 35.42, "std": 19.25, "min": 0, "max": 75, "pct": 47.22}, {"competencia": "LECTURA CRÍTICA", "n": 36, "mean": 49.97, "std": 26.91, "min": 0, "max": 75, "pct": 66.63}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 36, "mean": 52.08, "std": 17.29, "min": 25, "max": 75, "pct": 69.44}]}, {"programa": "LI. EDUCACION FISICA", "total_0a300": {"n": 46, "mean": 207.93, "std": 54.49, "min": 87, "max": 300, "pct": 69.31}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 46, "mean": 62.83, "std": 20.93, "min": 0, "max": 75, "pct": 83.77}, {"competencia": "INGLÉS", "n": 46, "mean": 39.67, "std": 20.8, "min": 0, "max": 75, "pct": 52.9}, {"competencia": "LECTURA CRÍTICA", "n": 46, "mean": 47.28, "std": 30.04, "min": 0, "max": 75, "pct": 63.04}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 46, "mean": 58.15, "std": 22.39, "min": 0, "max": 75, "pct": 77.54}]}, {"programa": "LIC. CIENACIAS NATURALES", "total_0a300": {"n": 45, "mean": 196.0, "std": 65.25, "min": 50, "max": 300, "pct": 65.33}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 45, "mean": 51.8, "std": 25.57, "min": 0, "max": 75, "pct": 69.07}, {"competencia": "INGLÉS", "n": 45, "mean": 40.56, "std": 19.43, "min": 0, "max": 75, "pct": 54.07}, {"competencia": "LECTURA CRÍTICA", "n": 45, "mean": 50.87, "std": 26.69, "min": 0, "max": 75, "pct": 67.82}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 45, "mean": 52.78, "std": 22.75, "min": 0, "max": 75, "pct": 70.37}]}, {"programa": "LIC. EN ARTES", "total_0a300": {"n": 43, "mean": 195.86, "std": 66.48, "min": 25, "max": 300, "pct": 65.29}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 43, "mean": 55.12, "std": 23.51, "min": 0, "max": 75, "pct": 73.49}, {"competencia": "INGLÉS", "n": 43, "mean": 43.6, "std": 17.33, "min": 0, "max": 75, "pct": 58.14}, {"competencia": "LECTURA CRÍTICA", "n": 43, "mean": 41.91, "std": 30.84, "min": 0, "max": 75, "pct": 55.88}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 43, "mean": 55.23, "std": 24.13, "min": 0, "max": 75, "pct": 73.64}]}, {"programa": "LIC. EN MATEMATICAS", "total_0a300": {"n": 25, "mean": 219.16, "std": 50.71, "min": 75, "max": 300, "pct": 73.05}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 25, "mean": 60.12, "std": 21.52, "min": 0, "max": 75, "pct": 80.16}, {"competencia": "INGLÉS", "n": 25, "mean": 39.0, "std": 20.51, "min": 0, "max": 75, "pct": 52.0}, {"competencia": "LECTURA CRÍTICA", "n": 25, "mean": 51.04, "std": 28.38, "min": 0, "max": 75, "pct": 68.05}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 25, "mean": 69.0, "std": 13.07, "min": 25, "max": 75, "pct": 92.0}]}, {"programa": "LIC. EN MUSICA", "total_0a300": {"n": 34, "mean": 202.65, "std": 55.62, "min": 88, "max": 275, "pct": 67.55}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 34, "mean": 59.68, "std": 22.72, "min": 0, "max": 75, "pct": 79.57}, {"competencia": "INGLÉS", "n": 34, "mean": 39.71, "std": 18.58, "min": 0, "max": 75, "pct": 52.94}, {"competencia": "LECTURA CRÍTICA", "n": 34, "mean": 47.38, "std": 29.66, "min": 0, "max": 75, "pct": 63.18}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 34, "mean": 55.88, "std": 21.37, "min": 25, "max": 75, "pct": 74.51}]}, {"programa": "LIC. LENGUAS CASTELLANAS E INGLES", "total_0a300": {"n": 1, "mean": 275.0, "std": 0, "min": 275, "max": 275, "pct": 91.67}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 1, "mean": 75.0, "std": 0, "min": 75, "max": 75, "pct": 100.0}, {"competencia": "INGLÉS", "n": 1, "mean": 75.0, "std": 0, "min": 75, "max": 75, "pct": 100.0}, {"competencia": "LECTURA CRÍTICA", "n": 1, "mean": 75.0, "std": 0, "min": 75, "max": 75, "pct": 100.0}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 1, "mean": 50.0, "std": 0, "min": 50, "max": 50, "pct": 66.67}]}, {"programa": "LIC. LITERATURA Y LENGUA CASTELLANA", "total_0a300": {"n": 31, "mean": 200.13, "std": 59.79, "min": 63, "max": 300, "pct": 66.71}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 31, "mean": 55.74, "std": 23.39, "min": 0, "max": 75, "pct": 74.32}, {"competencia": "INGLÉS", "n": 31, "mean": 42.74, "std": 19.57, "min": 0, "max": 75, "pct": 56.99}, {"competencia": "LECTURA CRÍTICA", "n": 31, "mean": 48.42, "std": 27.7, "min": 0, "max": 75, "pct": 64.56}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 31, "mean": 53.23, "std": 24.78, "min": 0, "max": 75, "pct": 70.97}]}, {"programa": "LIC. LTERATURA EN ESPAÑOL E INGLES", "total_0a300": {"n": 4, "mean": 265.75, "std": 11.93, "min": 250, "max": 275, "pct": 88.58}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 4, "mean": 65.75, "std": 18.5, "min": 38, "max": 75, "pct": 87.67}, {"competencia": "INGLÉS", "n": 4, "mean": 50.0, "std": 20.41, "min": 25, "max": 75, "pct": 66.67}, {"competencia": "LECTURA CRÍTICA", "n": 4, "mean": 75.0, "std": 0.0, "min": 75, "max": 75, "pct": 100.0}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 4, "mean": 75.0, "std": 0.0, "min": 75, "max": 75, "pct": 100.0}]}, {"programa": "MICROBILOGIA", "total_0a300": {"n": 35, "mean": 196.26, "std": 54.36, "min": 50, "max": 300, "pct": 65.42}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 35, "mean": 59.09, "std": 22.65, "min": 0, "max": 75, "pct": 78.78}, {"competencia": "INGLÉS", "n": 35, "mean": 37.86, "std": 16.46, "min": 0, "max": 75, "pct": 50.48}, {"competencia": "LECTURA CRÍTICA", "n": 35, "mean": 45.03, "std": 29.88, "min": 0, "max": 75, "pct": 60.04}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 35, "mean": 54.29, "std": 24.62, "min": 0, "max": 75, "pct": 72.38}]}, {"programa": "PSICOLOGIA", "total_0a300": {"n": 24, "mean": 231.33, "std": 53.43, "min": 50, "max": 300, "pct": 77.11}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 24, "mean": 62.62, "std": 21.02, "min": 0, "max": 75, "pct": 83.5}, {"competencia": "INGLÉS", "n": 24, "mean": 43.75, "std": 21.17, "min": 0, "max": 75, "pct": 58.33}, {"competencia": "LECTURA CRÍTICA", "n": 24, "mean": 62.46, "std": 23.93, "min": 0, "max": 75, "pct": 83.28}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 24, "mean": 62.5, "std": 19.5, "min": 0, "max": 75, "pct": 83.33}]}, {"programa": "SOCIOLOGIA", "total_0a300": {"n": 49, "mean": 189.9, "std": 53.79, "min": 62, "max": 275, "pct": 63.3}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 49, "mean": 61.31, "std": 21.14, "min": 0, "max": 75, "pct": 81.74}, {"competencia": "INGLÉS", "n": 49, "mean": 39.29, "std": 20.41, "min": 0, "max": 75, "pct": 52.38}, {"competencia": "LECTURA CRÍTICA", "n": 49, "mean": 44.41, "std": 29.32, "min": 0, "max": 75, "pct": 59.21}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 49, "mean": 44.9, "std": 24.46, "min": 0, "max": 75, "pct": 59.86}]}, {"programa": "TÉCNICO PROFESIONAL EN PRODUCCIÓN ACUÍCOLA CONTINENTAL", "total_0a300": {"n": 38, "mean": 196.55, "std": 75.55, "min": 63, "max": 300, "pct": 65.52}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 38, "mean": 52.47, "std": 25.38, "min": 0, "max": 75, "pct": 69.96}, {"competencia": "INGLÉS", "n": 38, "mean": 45.39, "std": 20.84, "min": 0, "max": 75, "pct": 60.53}, {"competencia": "LECTURA CRÍTICA", "n": 38, "mean": 47.37, "std": 29.8, "min": 0, "max": 75, "pct": 63.16}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 38, "mean": 51.32, "std": 27.23, "min": 0, "max": 75, "pct": 68.42}]}, {"programa": "Técnico Profesional en Producción Acuícola Continental", "total_0a300": {"n": 35, "mean": 201.89, "std": 72.44, "min": 50, "max": 300, "pct": 67.3}, "competencias_0a75": [{"competencia": "COMPETENCIAS CIUDADANAS", "n": 35, "mean": 49.34, "std": 29.83, "min": 0, "max": 75, "pct": 65.79}, {"competencia": "INGLÉS", "n": 35, "mean": 42.86, "std": 23.93, "min": 0, "max": 75, "pct": 57.14}, {"competencia": "LECTURA CRÍTICA", "n": 35, "mean": 50.4, "std": 27.18, "min": 0, "max": 75, "pct": 67.2}, {"competencia": "RAZONAMIENTO CUANTITATIVO", "n": 35, "mean": 59.29, "std": 21.93, "min": 0, "max": 75, "pct": 79.05}]}]}]};
function fmt(n,d=2){ return Number(n).toFixed(d); }
function sedeNode(name){ return DATA.sedes.find(s=>s.sede===name); }

// Tabla + gráfico por sede
const tbSedes = document.getElementById("tb-sedes");
let sedeLbl=[], sedeMean=[];
DATA.sedes.forEach(s=>{
  sedeLbl.push(s.sede);
  sedeMean.push(s.general.mean);
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${s.sede}</td><td>${s.general.n}</td><td>${fmt(s.general.mean)}</td><td>${fmt(s.general.pct,1)}%</td><td>${fmt(s.general.std)}</td><td>${s.general.min}</td><td>${s.general.max}</td>`;
  tbSedes.appendChild(tr);
});
new Chart(document.getElementById("chartPorSede"),{
  type:"bar",
  data:{labels:sedeLbl,datasets:[{label:"Promedio (0–300)",data:sedeMean}]},
  options:{responsive:true,scales:{y:{beginAtZero:true,suggestedMax:300}}}
});

// Aguachica
const ag = DATA.sedes.find(s=>s.sede.toUpperCase().includes("AGUACHICA"));
if (ag){
  const labels = ag.programas.map(p=>p.programa);
  const vals = ag.programas.map(p=>p.total_0a300.mean);
  new Chart(document.getElementById("chartAguachicaProgramas"),{
    type:"bar",
    data:{labels:labels,datasets:[{label:"Promedio (0–300)",data:vals}]},
    options:{indexAxis:"y",scales:{x:{beginAtZero:true,suggestedMax:300}}}
  });
  const tb = document.getElementById("tb-aguachica");
  ag.programas.slice().sort((a,b)=>b.total_0a300.mean-a.total_0a300.mean).forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.programa}</td><td>${p.total_0a300.n}</td><td>${fmt(p.total_0a300.mean)}</td><td>${fmt(p.total_0a300.pct,1)}%</td><td>${fmt(p.total_0a300.std)}</td><td>${p.total_0a300.min}</td><td>${p.total_0a300.max}</td>`;
    tb.appendChild(tr);
  });
}

// Valledupar
const va = DATA.sedes.find(s=>s.sede.toUpperCase().includes("VALLEDUPAR"));
if (va){
  const labels = va.programas.map(p=>p.programa);
  const vals = va.programas.map(p=>p.total_0a300.mean);
  new Chart(document.getElementById("chartValleduparProgramas"),{
    type:"bar",
    data:{labels:labels,datasets:[{label:"Promedio (0–300)",data:vals}]},
    options:{indexAxis:"y",scales:{x:{beginAtZero:true,suggestedMax:300}}}
  });
  const tb = document.getElementById("tb-valledupar");
  va.programas.slice().sort((a,b)=>b.total_0a300.mean-a.total_0a300.mean).forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.programa}</td><td>${p.total_0a300.n}</td><td>${fmt(p.total_0a300.mean)}</td><td>${fmt(p.total_0a300.pct,1)}%</td><td>${fmt(p.total_0a300.std)}</td><td>${p.total_0a300.min}</td><td>${p.total_0a300.max}</td>`;
    tb.appendChild(tr);
  });
}

// Ejemplo: Administración de Empresas – Valledupar
if (va){
  const ejemplo = va.programas.find(p=>p.programa.toUpperCase().includes("ADMINISTRACION DE EMPRESAS"));
  if (ejemplo){
    const labels = ejemplo.competencias_0a75.map(c=>c.competencia);
    const means = ejemplo.competencias_0a75.map(c=>c.mean);
    new Chart(document.getElementById("chartEjemploRadar"),{
      type:"radar",
      data:{labels:labels,datasets:[{label:"Promedio (0–75)",data:means,fill:true}]},
      options:{responsive:true,scales:{r:{suggestedMin:0,suggestedMax:75}}}
    });
    const tb = document.getElementById("tb-ejemplo");
    ejemplo.competencias_0a75.forEach(c=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${c.competencia}</td><td>${c.n}</td><td>${fmt(c.mean)}</td><td>${fmt(c.pct,1)}%</td><td>${fmt(c.std)}</td><td>${c.min}</td><td>${c.max}</td>`;
      tb.appendChild(tr);
    });
  }
}

// Selectores Dinámicos
const selS = document.getElementById("selSede");
const selP = document.getElementById("selProg");
DATA.sedes.forEach(s=>{ const o=document.createElement("option"); o.value=s.sede; o.textContent=s.sede; selS.appendChild(o); });
function refreshProg(){
  selP.innerHTML="";
  const s = sedeNode(selS.value);
  s.programas.forEach(p=>{ const o=document.createElement("option"); o.value=p.programa; o.textContent=p.programa; selP.appendChild(o); });
}
function renderTables(){
  const s = sedeNode(selS.value);
  const tb1 = document.getElementById("tb-prog-sel");
  tb1.innerHTML="";
  s.programas.slice().sort((a,b)=>b.total_0a300.mean-a.total_0a300.mean).forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.programa}</td><td>${p.total_0a300.n}</td><td>${fmt(p.total_0a300.mean)}</td><td>${fmt(p.total_0a300.pct,1)}%</td><td>${fmt(p.total_0a300.std)}</td><td>${p.total_0a300.min}</td><td>${p.total_0a300.max}</td>`;
    tb1.appendChild(tr);
  });
  const tb2 = document.getElementById("tb-comp-sel");
  tb2.innerHTML="";
  const p = s.programas.find(x=>x.programa===selP.value);
  p.competencias_0a75.slice().sort((a,b)=>a.competencia.localeCompare(b.competencia)).forEach(c=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${c.competencia}</td><td>${c.n}</td><td>${fmt(c.mean)}</td><td>${fmt(c.pct,1)}%</td><td>${fmt(c.std)}</td><td>${c.min}</td><td>${c.max}</td>`;
    tb2.appendChild(tr);
  });
}
selS.addEventListener("change",()=>{ refreshProg(); renderTables(); });
selP.addEventListener("change",()=>{ renderTables(); });
selS.value = DATA.sedes[0]?.sede || "";
refreshProg();
renderTables();

// Export CSV
document.getElementById("btnCSV").addEventListener("click",()=>{
  const s = sedeNode(selS.value);
  const p = s.programas.find(x=>x.programa===selP.value);
  const rows = [["Sede","Programa","Competencia","n","mean","std","min","max","pct"]];
  p.competencias_0a75.forEach(c=>rows.push([s.sede,p.programa,c.competencia,c.n,c.mean,c.std,c.min,c.max,c.pct]));
  const csv = rows.map(r=>r.join(",")).join("\n");
  const blob = new Blob([csv],{type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href=url; a.download=`competencias_${s.sede}_${p.programa}.csv`; a.click(); URL.revokeObjectURL(url);
});
</script>

</body>
</html>
